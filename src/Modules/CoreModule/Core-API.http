@baseUrl = https://localhost:7144

###################################################################################
## CoreModule Customer API Integration Tests (HTTP file)                         ##
##                                                                               ##
## This file exercises the full set of customer endpoints exposed by             ##
## `CoreCustomerEndpoints`                                                       ##
##                                                                               ##
## Endpoints covered:                                                            ##
##  GET    /api/core/customers/{id}          (Find one)                          ##
##  GET    /api/core/customers               (Find all / list)                   ##
##  POST   /api/core/customers               (Create)                            ##
##  PUT    /api/core/customers/{id}          (Update)                            ##
##  PUT    /api/core/customers/{id}/status   (Update status)                     ##
##  DELETE /api/core/customers/{id}          (Delete)                            ##
##                                                                               ##
## Variables:                                                                    ##
##  @customerId       A seeded existing customer (read/update/delete scenarios)  ##
##  @concurrencyVersion The concurrency version of the existing customer         ##
##                                                                               ##
###################################################################################

@customerId = e4f672fe-82d8-7cb3-444f-4486bf6fb163
@concurrencyVersion = 31810000-a4f4-f875-49a5-08de04be4419

###################################################################################
### [GET] Customers - Find One                                                  ###
GET {{baseUrl}}/api/core/customers/{{customerId}} HTTP/1.1

###################################################################################
### [GET] Customers - Find All                                                  ###
GET {{baseUrl}}/api/core/customers HTTP/1.1

###################################################################################
### [POST] Customers - Create                                                   ###
POST {{baseUrl}}/api/core/customers HTTP/1.1
Content-Type: application/json

{
  "firstName": "John{{$randomInt 1000 9999}}",
  "lastName": "Doe{{$randomInt 1000 9999}}",
  "email": "john.doe{{$randomInt 1000 9999}}@example.com",
  "status": 1
}

# > {% client.global.set("customerId", response.body.id); %}

###################################################################################
### [PUT] Customers - Update                                                    ###
PUT {{baseUrl}}/api/core/customers/{{customerId}} HTTP/1.1
Content-Type: application/json

{
  "id": "{{customerId}}",
  "firstName": "John{{$randomInt 1000 9999}}Changed",
  "lastName": "Doe{{$randomInt 1000 9999}}Changed",
  "email": "john.doe{{$randomInt 1000 9999}}changed@example.com",
  "status": 1,
  "concurrencyVersion": "{{concurrencyVersion}}"
}

###################################################################################
### [PUT] Customers - Change Status -> Active                                   ###
PUT {{baseUrl}}/api/core/customers/{{customerId}}/status HTTP/1.1
Content-Type: application/json

{
  "status": 2
}

###################################################################################
### [PUT] Customers - Change Status -> Retired                                  ###
### (Run after Create; updates newly created customer)                          ###
PUT {{baseUrl}}/api/core/customers/{{customerId}}/status HTTP/1.1
Content-Type: application/json

{
  "status": 3
}

###################################################################################
### [DELETE] Customers - Delete (Created)                                       ###
### (Idempotent test - expect 204 first time, 404 if repeated)                  ###
DELETE {{baseUrl}}/api/core/customers/{{customerId}} HTTP/1.1

###################################################################################
### [NEGATIVE] Customers - Get Not Found (Random GUID)                          ###
### (Should return 404)                                                         ###
GET {{baseUrl}}/api/core/customers/00000000-0000-0000-0000-000000000001 HTTP/1.1

###################################################################################
### [NEGATIVE] Customers - Change Status Invalid (Expect 400)                   ###
PUT {{baseUrl}}/api/core/customers/{{customerId}}/status HTTP/1.1
Content-Type: application/json

{
  "status": 99
}
###################################################################################
### End of Customer API HTTP tests                                              ###